[tox]
envlist = py3{7,8,9,10,11,12,13}, pypy3{9,10}, ruff, mypy, docs
isolated_build = true
requires =
    tox>4.8
    tox-uv>=1.12
installer = uv

[gh-actions]
python =
    3: py313
    3.7: py37
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313
    pypy3: pypy39
    pypy3.9: pypy39
    pypy3.10: pypy310

[testenv:ruff]
basepython = python3.13
dependency_groups = lint
skip_install = true
commands  =
    python -m ruff check src tests
    python -m ruff format --check src tests

[testenv:mypy]
basepython = python3.13
dependency_groups = lint, test
skip_install = true
#setenv =
#    PYTHONPATH = {toxinidir}/src
commands =
    python -m mypy src tests

[testenv:docs]
basepython = python3.13
dependency_groups = doc
skip_install = true
commands =
    python -m sphinx -b html -nEW docs docs/_build/html

[testenv]
dependency_groups = test
commands =
    # to also run the time-consuming tests: tox -e py312 -- --run-slow
    # to run the benchmarks: tox -e py312 -- -k benchmarks --benchmark-enable
    py3{7,8,9,10,11,13},pypy3{9,10}: python -m pytest tests {posargs}
    py313: python -m pytest tests {posargs: --cov-report=term-missing --cov=graphql --cov=tests --cov-fail-under=100}
